<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earthquake & Smoke Monitoring Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2.5rem;
            color: var(--success);
        }

        .logo-text h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo-text p {
            color: #aaa;
            font-size: 0.9rem;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 50px;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            background: #0f0;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Main Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.2rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.5rem;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-normal { background: rgba(76, 201, 240, 0.2); color: #4cc9f0; }
        .badge-alert { background: rgba(247, 37, 133, 0.2); color: #f72585; animation: alert-pulse 1s infinite; }
        .badge-warning { background: rgba(248, 150, 30, 0.2); color: #f8961e; }

        @keyframes alert-pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Sensor Cards */
        .sensor-value {
            font-size: 3.5rem;
            font-weight: 700;
            text-align: center;
            margin: 20px 0;
        }

        .sensor-unit {
            font-size: 1.2rem;
            color: #aaa;
        }

        .sensor-progress {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease-in-out;
        }

        .progress-safe { background: linear-gradient(90deg, #4cc9f0, #4361ee); }
        .progress-warning { background: linear-gradient(90deg, #f8961e, #f3722c); }
        .progress-danger { background: linear-gradient(90deg, #f72585, #b5179e); }

        /* Chart Container */
        .chart-container {
            grid-column: span 2;
            height: 300px;
        }

        .chart-card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .chart-wrapper {
            flex-grow: 1;
            position: relative;
        }

        /* Alert History */
        .history-container {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #4cc9f0;
        }

        .history-item.earthquake { border-left-color: #f72585; }
        .history-item.smoke { border-left-color: #f8961e; }

        .history-time {
            font-size: 0.9rem;
            color: #aaa;
        }

        .history-type {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        /* Controls */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 25px;
            background: rgba(67, 97, 238, 0.1);
            border: 1px solid rgba(67, 97, 238, 0.3);
            border-radius: 15px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .control-btn:hover {
            background: rgba(67, 97, 238, 0.2);
            transform: translateY(-3px);
        }

        .control-btn i {
            font-size: 2.5rem;
            color: #4cc9f0;
        }

        .control-btn.danger {
            background: rgba(247, 37, 133, 0.1);
            border-color: rgba(247, 37, 133, 0.3);
        }

        .control-btn.danger i {
            color: #f72585;
        }

        .control-btn.warning {
            background: rgba(248, 150, 30, 0.1);
            border-color: rgba(248, 150, 30, 0.3);
        }

        .control-btn.warning i {
            color: #f8961e;
        }

        /* System Info */
        .system-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
        }

        .info-label {
            color: #aaa;
        }

        .info-value {
            font-weight: 600;
            color: #4cc9f0;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                grid-column: span 1;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(67, 97, 238, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(67, 97, 238, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="logo-text">
                    <h1>SeismicGuard Pro</h1>
                    <p>Real-time Earthquake & Smoke Monitoring System</p>
                </div>
            </div>
            <div class="connection-status">
                <div class="status-dot"></div>
                <span>Connected to ESP32</span>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- System Status Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-tachometer-alt card-icon"></i>
                        <span>System Status</span>
                    </div>
                    <div id="system-status-badge" class="status-badge badge-normal">NORMAL</div>
                </div>
                <div class="sensor-value" id="system-status-text">OPERATIONAL</div>
                <div class="sensor-progress">
                    <div id="system-health-bar" class="progress-bar progress-safe" style="width: 95%"></div>
                </div>
                <div class="info-item">
                    <span class="info-label">Uptime:</span>
                    <span class="info-value" id="uptime">00:00:00</span>
                </div>
            </div>

            <!-- Smoke Level Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-smog card-icon"></i>
                        <span>Smoke Level</span>
                    </div>
                    <div id="smoke-status-badge" class="status-badge badge-normal">SAFE</div>
                </div>
                <div class="sensor-value">
                    <span id="smoke-value">0</span>
                    <span class="sensor-unit">PPM</span>
                </div>
                <div class="sensor-progress">
                    <div id="smoke-progress" class="progress-bar progress-safe" style="width: 10%"></div>
                </div>
                <div class="info-item">
                    <span class="info-label">Threshold:</span>
                    <span class="info-value">300 PPM</span>
                </div>
            </div>

            <!-- Vibration Status Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-mountain card-icon"></i>
                        <span>Seismic Activity</span>
                    </div>
                    <div id="vibration-status-badge" class="status-badge badge-normal">STABLE</div>
                </div>
                <div class="sensor-value">
                    <span id="vibration-level">0</span>
                    <span class="sensor-unit">Level</span>
                </div>
                <div class="sensor-progress">
                    <div id="vibration-progress" class="progress-bar progress-safe" style="width: 5%"></div>
                </div>
                <div class="info-item">
                    <span class="info-label">Last Event:</span>
                    <span class="info-value" id="last-vibration-time">Never</span>
                </div>
            </div>

            <!-- Alerts Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-bell card-icon"></i>
                        <span>Alerts</span>
                    </div>
                    <div class="status-badge badge-normal" id="alert-count-badge">0</div>
                </div>
                <div class="sensor-value">
                    <span id="active-alerts">0</span>
                    <span class="sensor-unit">Active</span>
                </div>
                <div style="margin-top: 20px;">
                    <div class="info-item">
                        <span class="info-label">Earthquake:</span>
                        <span class="info-value" id="earthquake-alerts">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Smoke:</span>
                        <span class="info-value" id="smoke-alerts">0</span>
                    </div>
                </div>
            </div>

            <!-- Real-time Chart -->
            <div class="chart-container">
                <div class="card chart-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-line card-icon"></i>
                            <span>Real-time Sensor Data</span>
                        </div>
                        <div class="status-badge badge-normal">
                            <span id="chart-time-range">Last 5 min</span>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="sensorChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Alert History -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-history card-icon"></i>
                        <span>Recent Events</span>
                    </div>
                </div>
                <div class="history-container" id="alert-history">
                    <!-- Events will be populated here -->
                    <div class="history-item">
                        <div class="history-type">
                            <i class="fas fa-info-circle"></i>
                            <span>System Started</span>
                        </div>
                        <div class="history-time" id="current-time">Just now</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="controls-grid">
            <div class="control-btn" onclick="sendCommand('test_alert')">
                <i class="fas fa-bullhorn"></i>
                <div>
                    <h3>Test Alert</h3>
                    <p>Test all alarms</p>
                </div>
            </div>
            
            <div class="control-btn warning" onclick="sendCommand('silence')">
                <i class="fas fa-volume-mute"></i>
                <div>
                    <h3>Silence Alarm</h3>
                    <p>Stop current alert</p>
                </div>
            </div>
            
            <div class="control-btn" onclick="sendCommand('reset')">
                <i class="fas fa-redo"></i>
                <div>
                    <h3>Reset System</h3>
                    <p>Reset to normal</p>
                </div>
            </div>
            
            <div class="control-btn" onclick="sendCommand('calibrate')">
                <i class="fas fa-sliders-h"></i>
                <div>
                    <h3>Calibrate</h3>
                    <p>Calibrate sensors</p>
                </div>
            </div>
            
            <div class="control-btn danger" onclick="sendCommand('emergency_stop')">
                <i class="fas fa-power-off"></i>
                <div>
                    <h3>Emergency Stop</h3>
                    <p>Stop all systems</p>
                </div>
            </div>
        </div>

        <!-- System Information -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-microchip card-icon"></i>
                    <span>System Information</span>
                </div>
            </div>
            <div class="system-info">
                <div class="info-item">
                    <span class="info-label">Device ID:</span>
                    <span class="info-value" id="device-id">ESP32-MONITOR-001</span>
                </div>
                <div class="info-item">
                    <span class="info-label">WiFi Signal:</span>
                    <span class="info-value" id="wifi-strength">-45 dBm</span>
                </div>
                <div class="info-item">
                    <span class="info-label">IP Address:</span>
                    <span class="info-value" id="ip-address">192.168.1.100</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Last Update:</span>
                    <span class="info-value" id="last-update">Just now</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>SeismicGuard Pro Monitoring System | ESP32 Module | Â© 2024 All Rights Reserved</p>
            <p>Version 2.1.0 | Update Frequency: <span id="update-freq">2s</span> | <span id="connection-status">Connected</span></p>
        </div>
    </div>

    <script>
        // Global variables
        let sensorChart;
        let smokeHistory = [];
        let vibrationHistory = [];
        let alertHistory = [];
        let maxHistoryPoints = 50;
        let lastUpdateTime = new Date();
        let updateInterval = 2000; // Update every 2 seconds
        let earthquakeCount = 0;
        let smokeAlertCount = 0;

        // Initialize Chart
        function initChart() {
            const ctx = document.getElementById('sensorChart').getContext('2d');
            sensorChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Smoke Level (PPM)',
                            data: [],
                            borderColor: '#4cc9f0',
                            backgroundColor: 'rgba(76, 201, 240, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Vibration Level',
                            data: [],
                            borderColor: '#f8961e',
                            backgroundColor: 'rgba(248, 150, 30, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 500
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#aaa'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#aaa'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#fff',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(26, 26, 46, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#4361ee',
                            borderWidth: 1
                        }
                    }
                }
            });
        }

        // Update sensor data from ESP32
        async function updateSensorData() {
            try {
                const response = await fetch('/api/sensor-data');
                const data = await response.json();
                
                // Update current time
                document.getElementById('current-time').textContent = getCurrentTime();
                document.getElementById('last-update').textContent = 'Just now';
                
                // Update system status
                updateSystemStatus(data);
                
                // Update sensor values
                document.getElementById('smoke-value').textContent = data.smoke_value;
                document.getElementById('vibration-level').textContent = data.vibration_detected ? '100' : '0';
                
                // Update progress bars
                updateProgressBars(data);
                
                // Update chart
                updateChartData(data);
                
                // Update system info
                document.getElementById('wifi-strength').textContent = data.wifi_rssi + ' dBm';
                document.getElementById('ip-address').textContent = data.ip_address;
                
                // Update alert counts
                if (data.current_state === 1 && !data.vibration_detected) {
                    earthquakeCount++;
                    addAlertToHistory('Earthquake Detected!', 'earthquake');
                }
                if (data.current_state === 2 && data.smoke_value > 300) {
                    smokeAlertCount++;
                    addAlertToHistory(`Smoke Alert: ${data.smoke_value} PPM`, 'smoke');
                }
                
                document.getElementById('earthquake-alerts').textContent = earthquakeCount;
                document.getElementById('smoke-alerts').textContent = smokeAlertCount;
                document.getElementById('alert-count-badge').textContent = earthquakeCount + smokeAlertCount;
                
            } catch (error) {
                console.error('Error fetching sensor data:', error);
                document.getElementById('connection-status').textContent = 'Disconnected';
                document.getElementById('connection-status').style.color = '#f72585';
            }
        }

        // Update system status
        function updateSystemStatus(data) {
            const statusBadge = document.getElementById('system-status-badge');
            const statusText = document.getElementById('system-status-text');
            const vibrationBadge = document.getElementById('vibration-status-badge');
            const smokeBadge = document.getElementById('smoke-status-badge');
            
            // Update main system status
            switch(data.current_state) {
                case 0: // NORMAL
                    statusBadge.className = 'status-badge badge-normal';
                    statusBadge.textContent = 'NORMAL';
                    statusText.textContent = 'OPERATIONAL';
                    statusText.style.color = '#4cc9f0';
                    break;
                case 1: // EARTHQUAKE
                    statusBadge.className = 'status-badge badge-alert';
                    statusBadge.textContent = 'ALERT!';
                    statusText.textContent = 'EARTHQUAKE!';
                    statusText.style.color = '#f72585';
                    
                    vibrationBadge.className = 'status-badge badge-alert';
                    vibrationBadge.textContent = 'ACTIVE!';
                    document.getElementById('last-vibration-time').textContent = 'Now!';
                    
                    // Play alert sound
                    playAlertSound('earthquake');
                    break;
                case 2: // SMOKE
                    statusBadge.className = 'status-badge badge-alert';
                    statusBadge.textContent = 'ALERT!';
                    statusText.textContent = 'SMOKE DETECTED!';
                    statusText.style.color = '#f72585';
                    
                    smokeBadge.className = 'status-badge badge-alert';
                    smokeBadge.textContent = 'HIGH';
                    
                    // Play alert sound
                    playAlertSound('smoke');
                    break;
            }
            
            // Update vibration status
            if (data.vibration_detected && data.current_state !== 1) {
                vibrationBadge.className = 'status-badge badge-warning';
                vibrationBadge.textContent = 'MOVEMENT';
            } else if (!data.vibration_detected && data.current_state === 0) {
                vibrationBadge.className = 'status-badge badge-normal';
                vibrationBadge.textContent = 'STABLE';
            }
            
            // Update smoke status
            if (data.smoke_value > 400) {
                smokeBadge.className = 'status-badge badge-alert';
                smokeBadge.textContent = 'DANGER';
            } else if (data.smoke_value > 300) {
                smokeBadge.className = 'status-badge badge-warning';
                smokeBadge.textContent = 'HIGH';
            } else if (data.smoke_value > 200) {
                smokeBadge.className = 'status-badge badge-warning';
                smokeBadge.textContent = 'MODERATE';
            } else {
                smokeBadge.className = 'status-badge badge-normal';
                smokeBadge.textContent = 'SAFE';
            }
        }

        // Update progress bars
        function updateProgressBars(data) {
            // Smoke progress
            const smokeProgress = document.getElementById('smoke-progress');
            const smokeWidth = Math.min((data.smoke_value / 500) * 100, 100);
            smokeProgress.style.width = smokeWidth + '%';
            
            if (data.smoke_value > 400) {
                smokeProgress.className = 'progress-bar progress-danger';
            } else if (data.smoke_value > 300) {
                smokeProgress.className = 'progress-bar progress-warning';
            } else {
                smokeProgress.className = 'progress-bar progress-safe';
            }
            
            // Vibration progress
            const vibrationProgress = document.getElementById('vibration-progress');
            const vibrationWidth = data.vibration_detected ? 100 : 5;
            vibrationProgress.style.width = vibrationWidth + '%';
            vibrationProgress.className = data.vibration_detected ? 'progress-bar progress-danger' : 'progress-bar progress-safe';
            
            // Active alerts
            const activeAlerts = document.getElementById('active-alerts');
            const alertCount = (data.current_state !== 0 ? 1 : 0) + (data.smoke_value > 300 ? 1 : 0);
            activeAlerts.textContent = alertCount;
            
            if (alertCount > 0) {
                activeAlerts.style.color = '#f72585';
                document.getElementById('alert-count-badge').className = 'status-badge badge-alert';
            } else {
                activeAlerts.style.color = '#4cc9f0';
                document.getElementById('alert-count-badge').className = 'status-badge badge-normal';
            }
        }

        // Update chart data
        function updateChartData(data) {
            const now = new Date();
            const timeLabel = now.getHours().toString().padStart(2, '0') + ':' + 
                             now.getMinutes().toString().padStart(2, '0') + ':' + 
                             now.getSeconds().toString().padStart(2, '0');
            
            // Add new data
            sensorChart.data.labels.push(timeLabel);
            sensorChart.data.datasets[0].data.push(data.smoke_value);
            sensorChart.data.datasets[1].data.push(data.vibration_detected ? 100 : 0);
            
            // Keep only last 20 points
            if (sensorChart.data.labels.length > maxHistoryPoints) {
                sensorChart.data.labels.shift();
                sensorChart.data.datasets[0].data.shift();
                sensorChart.data.datasets[1].data.shift();
            }
            
            // Update chart
            sensorChart.update('none');
        }

        // Add alert to history
        function addAlertToHistory(message, type) {
            const historyContainer = document.getElementById('alert-history');
            const alertItem = document.createElement('div');
            alertItem.className = `history-item ${type}`;
            
            alertItem.innerHTML = `
                <div class="history-type">
                    <i class="fas ${type === 'earthquake' ? 'fa-mountain' : 'fa-smog'}"></i>
                    <span>${message}</span>
                </div>
                <div class="history-time">${getCurrentTime()}</div>
            `;
            
            // Add to top
            historyContainer.insertBefore(alertItem, historyContainer.firstChild);
            
            // Keep only last 10 items
            if (historyContainer.children.length > 10) {
                historyContainer.removeChild(historyContainer.lastChild);
            }
        }

        // Send command to ESP32
        async function sendCommand(command) {
            try {
                const response = await fetch(`/api/command?cmd=${command}`);
                const result = await response.text();
                
                // Show notification
                showNotification(`Command sent: ${result}`, 'success');
                
                // Add to history
                addAlertToHistory(`Command: ${command}`, 'info');
                
            } catch (error) {
                console.error('Error sending command:', error);
                showNotification('Failed to send command', 'error');
            }
        }

        // Show notification
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? 'rgba(76, 201, 240, 0.9)' : 'rgba(247, 37, 133, 0.9)'};
                color: white;
                border-radius: 10px;
                z-index: 1000;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                animation: slideIn 0.3s ease-out;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
            
            // Add CSS animations
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Play alert sound
        function playAlertSound(type) {
            // You can implement browser notification sounds here
            if (type === 'earthquake') {
                // Play earthquake alert sound
                const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQ=');
                audio.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        // Get current time formatted
        function getCurrentTime() {
            const now = new Date();
            return now.getHours().toString().padStart(2, '0') + ':' + 
                   now.getMinutes().toString().padStart(2, '0') + ':' + 
                   now.getSeconds().toString().padStart(2, '0');
        }

        // Update uptime counter
        function updateUptime() {
            const startTime = new Date();
            setInterval(() => {
                const now = new Date();
                const diff = Math.floor((now - startTime) / 1000);
                const hours = Math.floor(diff / 3600);
                const minutes = Math.floor((diff % 3600) / 60);
                const seconds = diff % 60;
                
                document.getElementById('uptime').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Initialize everything
        window.onload = function() {
            initChart();
            updateUptime();
            
            // Update sensor data immediately
            updateSensorData();
            
            // Then update every 2 seconds
            setInterval(updateSensorData, updateInterval);
            
            // Update connection status
            setInterval(() => {
                document.getElementById('connection-status').textContent = 'Connected';
                document.getElementById('connection-status').style.color = '#0f0';
            }, 5000);
        };
    </script>
</body>
</html>
